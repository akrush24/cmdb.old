{% extends "layout.html" %}
{% block body %}
  {% if session.logged_in %}
<div class="container-fluid">
	<div class="row"> <div class="col-xs-12 col-sm-6 col-md-8">
		<div class="panel panel-primary">
			<div class="panel-heading">Задачи</div>
				<div class="panel-body"> 	
	<button class="btn btn btn-default" data-toggle="modal" data-target="#addType">
		<span class="glyphicon glyphicon-plus"></span> Тип
	</button>

	<button class="btn btn btn-default" data-toggle="modal" data-target="#addOptions">
		<span class="glyphicon glyphicon-plus"></span> Опции
	</button>

<div id="livesearchjson"> <!-- http://forum.jquery.com/topic/pasrsing-json-data-for-autocomplete -->
	<input type="text" id="name">
	<input type="text" id="emailid">
<script> var data=[
             {"value":"123@example.com","label":"User 123","mail":"123@example.com"},
             {"value":"456","label":"User 456","mail":"456@example.com"},
             {"value":"789","label":"User 789","mail":"789@example.com"},
         ]
$("#name").autocomplete({
        source: "http://cmdb.at-consulting.ru:5000/get_list_user/",
        width: 300,
        max: 20,
        delay: 100,
        minLength: 1,
        autoFocus: true,
        cacheLength: 1,
        scroll: true,
        highlight: false,
        select: function(event, ui) {
			$("#emailid").val(ui.item.mail);
          var name = ui.item.mail;
          var label=ui.item.label;
		  /*
		  $("#emailid").val(ui.item.mail);
          var name = ui.item.mail;
          var label=ui.item.label; */
         }
    });
	
	</script>
	</div>
    <!-- Modal addType -->
<div class="modal fade" id="addType" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">Добавление нового типа</h4>
      </div>
      <div class="modal-body">			
      	 <div class="container-fluid" >
      	 	<div class="col-lg-6" >
				<form id="addtypeform" action="{{ url_for('new_type') }}" method="post">
				    <input type="text" class="form-control" placeholder="Введите новый тип" name="name" autocomplete="off" /> <br>
				</form>
			</div>	
    	</div> 
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default"  data-dismiss="modal" >Закрыть</button>
        <button type="submit"  class="btn btn-primary" onclick="document.getElementById('addtypeform').submit();">Добавить и сохранить</button>
      </div>
    </div>
  </div>
</div>
    <!-- Modal addType -->
    
    
    <!-- Modal addOptions -->
<div class="modal fade" id="addOptions" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">Добавить новую опцию у типа</h4>
      </div>
      <div class="modal-body">			
      	 <div class="container-fluid" >
      	 	<div class="col-lg-6" >
				<form id="addOptionsForm" action="{{ url_for('new_option') }}" method="post">
                    <select class="form-control" id="type_id" name="type_id">
						<option disabled>Тип</option>
                    </select><br>
                    <input type="text" class="form-control" placeholder="Введите новую опцию" name="name" autocomplete="off" /> 
						<script type="text/javascript">
							$(function(){
								$.getJSON('http://cmdb.at-consulting.ru:5000/get_list_type/', function(data) {
								  var i = -1;
									$.each(data, function(id, name) { 
									   i=i+1;
										$('#type_id').append('<option value="' + data[i].id + '">' + data[i].name + '</option>');
										});  
							});
						});
					</script>
				</form>
			</div>
    	</div> 
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
        <button type="submit"  class="btn btn-primary" onclick="document.getElementById('addOptionsForm').submit();"> Добавить и сохранить</button>
      </div>
    </div>
  </div>
</div>
    <!-- Modal addoptions -->
			</div> 
		</div>
    </div>
  </div>
</div>




<!-- отрисовываем табличку-->
    <table class=entries>
    <th>Типы</th>
    <tr>
    {% for cols_name in type_cols_names %}
        <td><center><b>{{ cols_name }}</b></center></td>
    {% endfor %}
    </tr>
        
    {% for entry in type_cols %}
        <tr>
        {% set k=0 %}

        {% for cell in entry %}

                <td>
                    {{ cell }}
                </td>

        {% endfor %}
        
        {% if session.logged_in %}
        
            <td><a href="/del_type/{{ entry.id }}"><img src="{{ url_for('static', filename='del.png') }}" alt="Del"></a></td>
        {% endif %}

    </tr>
    {% endfor %}
    </table>



    <table class=entries>
    <th>Свойства</th>
    <tr>
    {% for cols_name in option_cols_names %}
        <td><center><b>{{ cols_name }}</b></center></td>
    {% endfor %}
    </tr>
        
    {% for entry in option_cols %}
        <tr>
        {% set k=0 %}

        {% for cell in entry %}

                <td>
                    {{ cell }}
                </td>

        {% endfor %}
        
        {% if session.logged_in %}
        
            <td><a href="/del_option/{{ entry.id }}"><img src="{{ url_for('static', filename='del.png') }}" alt="Del"></a></td>
        {% endif %}

    </tr>
    {% endfor %}
    </table>


    <table class=entries>
    <th>Пользователи</th>
    <tr>
    {% for cols_name in user_cols_names %}
        <td><center><b>{{ cols_name }}</b></center></td>
    {% endfor %}
    </tr>
        
    {% for entry in user_cols %}
        <tr>
        {% set k=0 %}

        {% for cell in entry %}

                <td>
                    {{ cell }}
                </td>

        {% endfor %}
        
        {% if session.logged_in %}
        
            <td><a href="/del_user/{{ entry.id }}"><img src="{{ url_for('static', filename='del.png') }}" alt="Del"></a></td>
        {% endif %}

    </tr>
    {% endfor %}
    </table>

<!-- отрисовываем табличку-->

</body>
  {% endif %}
{% endblock %}