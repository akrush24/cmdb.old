<!doctype html>
<html lang="ru">
<title>CMDB</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" "> <!-- Адаптация для мобильных -->
<script src="{{ url_for('static', filename='jquery-2.1.1.min.js') }}"></script>
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css" />
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>

<script src="{{ url_for('static', filename='dynatable/jquery.dynatable.js') }}"></script> <!-- Отрисовка таблиц -->
<link rel="stylesheet" href="{{ url_for('static', filename='dynatable/jquery.dynatable.css') }}"> <!-- Отрисовка таблиц стилей -->

<script src="{{ url_for('static', filename='js/emailautocomplite.js') }}"></script> <!-- Автодополнение e-mail -->
<script src="{{ url_for('static', filename='bootstrap/js/bootstrap.min.js') }}"></script> <!-- Тема bootstrap -->
<link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css/bootstrap.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css/bootstrap-theme.min.css') }}">

<body>

  <nav class="navbar navbar-default " role="navigation"> 
  <div class="container-fluid"> 
        <ul class="nav navbar-nav navbar-left">
            <li><a href="{{ url_for('index') }}">cmdb.at-consulting.ru</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">&nbsp;Мои ресурсы<span class="caret"></span>&nbsp;<span class="badge pull-right">4</span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="{{ url_for('index', typename='VPS') }}">VPS&nbsp;<span class="badge pull-right">3</span></a></li>
            <li><a href="{{ url_for('index', typename='Ticket') }}">Ticket</a></li>
            <li><a href="{{ url_for('index', typename='Phone') }}">Phone&nbsp;<span class="badge pull-right">1</span></a></li>
            <li class="divider"></li>
            <li><a href="#">И много другого</a></li>
          </ul>
        </li>
        </ul>
        <form class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input id="name" type="text" class="form-control" placeholder="Поиск"> <!-- http://forum.jquery.com/topic/pasrsing-json-data-for-autocomplete -->
            </div>
        <button type="submit" class="btn hide"></button>
        </form>
        
        <ul class="nav navbar-nav navbar-right">
            <a class="btn btn-success navbar-btn" role="button" data-toggle="modal" data-target="#addTicket"><span class="glyphicon glyphicon-plus"></span>&nbsp;Новая заявка</a>
            <a href="{{ url_for('control') }}" class="btn btn-info navbar-btn" role="button"><span class="glyphicon glyphicon-wrench"></span>&nbsp;Панель управления</a>
            <a href="{{ url_for('logout') }}" class="btn btn-default navbar-btn" role="button"><span class="glyphicon glyphicon-log-out"></span>&nbsp;{{ user }}</a>
        </ul>
    </div>
  </nav>
 
 
 
 <!-- Modal addTicket -->
<div class="modal fade" id="addTicket" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">Добавить новый ресурс</h4>
      </div>
      <div class="modal-body">			
      	 <div class="container-fluid" >
      	 	<div class="col-lg-6" >
				<form name="Ticketform" id="addTicket" action="{{ url_for('newres') }}" method="post">
                    <select class="form-control" id="type_id_ticket" name="type_id">
						<option disabled>Тип</option>
                    </select><br>
                    <div id="inputs">
                    <script>
                    $(function(){
								$.getJSON('http://cmdb.at-consulting.ru:5000/get_list_type/', function(data) {
								  var i = -1;
									$.each(data, function(id, name) { 
									   i=i+1;
										$('#type_id_ticket').append('<option value="' + data[i].id + '">' + data[i].name + '</option>');
										});  
                                            });
                                        });

                    $('#type_id_ticket').change(function(){                                //подгрузка опций для типа
                                          var sellectedtype = $('#type_id_ticket option:selected').val();  // если выбран тип (изменён), то подгружаем нужные опции
                                            $( "#inputs" ).empty();                                 //очищаем контейнер от предыдущих объектов
                                            $(function(){                                           //сама функция подгрузки опций
                                                $.getJSON('{{ url_for('get_list_option') }}?type='+sellectedtype+'', function(data) {
                                                    var i = -1;
                                                $.each(data, function(id, name) { 
                                                    i=i+1;
                                                        $('#inputs').append('<div><input type="text" class="form-control" name="id' + data[i].id + '" placeholder="' + data[i].name + '" value="'+'" required=""/></div>');

                                                          });  
                                                        });
                                                       });
                                           }); //Конец функции выбора типа
					</script>
                    
                    </div>
                    <button type="submit"  class="btn hide">
				</form>
			</div>
    	</div> 
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
        <button type="submit" id="addticketsubmit" class="btn btn-primary" > Добавить и сохранить</button>
        <script> 

        $("#addticketsubmit").click(function()
    {
        $("form[name='Ticketform']").submit();
});

        </script>
      </div>
    </div>
  </div>
</div>
    <!-- Modal addTicket -->

<div>
{% block body %}{% endblock %}
</div>


  <nav class="navbar navbar-default navbar-fixed-bottom " role="navigation"> 
  <div class="container-fluid"> 
        {% for message in get_flashed_messages() %}
    <div class="alert alert-success" role="alert">
        <a href="#" class="alert-link">{{ message }}</a>
    </div>
    {% endfor %}
  </div>
  </nav>
  

  
  
</body>
</html>
